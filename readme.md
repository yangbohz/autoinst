# 使用说明

适用于CDS2版本客户端以及AIC自动安装项目,需要使用修改过的SPT配置文件,否则无论如何都会在安装过程中自动重启从而导致安装过程中断.大部分必要的系统设置通过组策略实现,脚本中可以自动将netfx相关的项目进行激活.

## 预期安装效果

安装完毕后,客户端以及AIC会具有指定的驱动版本以及补丁版本,指定的路径中会有简单的安装汇总,升级(如果有)汇总以及SVT汇总

在千兆网络以及SSD环境下，每台计算机预计花费20分钟时间,可以同时进行操作,也可以使用psexec进行批量推送,具体使用方式网上教程很多,不再赘述

## 限制

自动安装的驱动仅限于msi格式的安装包,如果非msi安装包有静默参数(具体实现方式可以参考palxt驱动的安装命令),也可以修改脚本实现自动安装,Thermo SII以及Waters驱动如果需要一起安装，需要修改一下脚本的配置部分以及内部的安装具体文件名。

## 准备条件

1. 服务器安装完毕,所有相关计算机加域完成
2. **PowerShell脚本执行权限设置为允许所有(可以通过组策略完成)**
3. 在服务器上建立一个共享目录,所有人完全控制.将本脚本以及软件安装包复制到共享目录中,确保任意一台计算机可以正常访问以及写入内容
4. 共享目录的目录结构不可随意变更,脚本中硬编码了目录名,如果不安要求来,安装将不会开始(会提示未检测到必要的文件).
5. 确定AIC的计算机名,如果AIC的计算机名不含有**AIC**字样,把AICList.txt中写上预计的AIC计算机名,一行一个。如果AIC的计算机名中包含**AIC**字样，则将AICList.txt文件直接删除即可
6. 将下面的两个SPT配置文件内容清空,防止安装过程中自动重启

```text
   OpenLab (CDS, ECMXT)~2.6~(Client, CMServices)~Win10.sysprep
   OpenLab CDS~2.6~AIC~Win10.sysprep
```

7. 如果未使用预定义的安捷伦策略，SPT文件夹下面需要有**IES Customerzed for CDS 2.6**配置文件的存在

### 要求的目录结构

```text
共享根路径
├─OpenLabCDS-2.6.0.841*
│  ├─Drivers*
│  │  ├─3P*
│  │  │  ├-Thermo*
│  │  │  ├-Waters*
│  │  │  └-Waters.Driver.msi
│  │  ├─AIC*
│  │  ├─010-GC Drivers.msi
│  │  └-其他msi格式安装包,名称随意,按名称顺序进行安装
│  ├-Update*(此文件夹放置解压出的更新包)
│  │  ├-OpenLab_CDS_Update.exe
│  │  └-其他补丁文件
│  ├-clt.properties*
│  ├-aic.properties*(这两个文件参考手册自行生成)
│  └-setup.exe(其他标准的文件此处不再列出)
└─AutoInst(本脚本位置,目录名可更改)
```

上面的文件结构中,标注有*符号的文件名或者目录名均不可更改, 3P文件夹仅有在需要安装Thermo或者Waters驱动的时候才需要建立，里面分别建立对应的文件夹即可，同时需要修改配套的脚本头部的开关。

## 运行方式

上述文件准备完毕后，用管理员权限开启Powershell窗口，直接输入脚本路径执行即可，例如

`\\olss\agilent\autoinst\autoinstcds26.ps1`

等待即可，可以观察命令行窗口提示的进度，一些常见的问题也会在这里反馈出来。安装完毕后会自动重启，同时在上面准备的共享路径根目录下会生成若干汇总文件，分别为

- Install_Summary.log   安装情况汇总
- Update_Summary.log    补丁更新情况汇总
- Exception.log         异常汇总（如无异常，将不生成）
- SVT_Summary.log       SVT报告情况汇总

## 安装流程

1. 启用.netfx 3.5
2. 根据AIC列表或者计算机名称安装AIC/客户端
3. 如果有补丁，安装
4. 卸载备份还原工具（仅2.6更新过的版本）
5. 安装adobe
6. 搜索Drivers下面的msi文件，根据名称逐一安装（排除AIC以及3P文件夹）
7. 安装Drivers下面的msp文件
8. 安装Waters或者thermo驱动
9. 执行SVT，写入汇总文件
10. 执行额外的服务修正
